---
# Example configuration for replicating directories of SQLite databases
# Demonstrates directory replication feature (issue #42)
#
# IMPORTANT: Replica Path Behavior
# ---------------------------------
# When using directory replication, each database gets a UNIQUE replica path
# to prevent data corruption. The relative path from the directory root is
# automatically appended to the configured replica path.
#
# Example:
#   directory: /var/lib/databases
#   replica path: backups/prod
#
# Results in:
#   /var/lib/databases/tenant1.db     → backups/prod/tenant1.db/ltx/...
#   /var/lib/databases/subdir/db2.db  → backups/prod/subdir/db2.db/ltx/...
#
# This ensures each database has isolated replica storage.

# Serve metrics over HTTP on port 9090.
addr: ":9090"

dbs:
  # Example 1: Replicate all .db files in a directory (non-recursive)
  # Replica paths: myapp/databases/<filename>/ltx/...
  - directory: /var/lib/myapp/databases
    pattern: "*.db"
    recursive: false
    replica:
      type: s3
      bucket: my-bucket
      path: myapp/databases
      region: us-east-1

  # Example 2: Replicate SQLite files recursively in multi-tenant dir
  # Perfect for multi-tenancy with separate databases per tenant
  # Replica paths preserve directory structure:
  #   /var/lib/tenants/team-a/prod.sqlite → tenants/team-a/prod.sqlite/ltx/...
  #   /var/lib/tenants/team-b/prod.sqlite → tenants/team-b/prod.sqlite/ltx/...
  - directory: /var/lib/tenants
    pattern: "*.sqlite"
    recursive: true
    replica:
      type: s3
      bucket: tenant-backups
      path: tenants
      region: us-west-2
      sync-interval: 1m

  # Example 3: Replicate all database files with multiple replicas
  - directory: /data/production
    pattern: "*.db"
    recursive: true
    replicas:
      - type: s3
        bucket: prod-backups
        path: databases
        region: us-east-1
      - type: file
        path: /backup/databases

  # Example 4: Mix of directory and single file replication in same config
  # Single database with specific settings
  - path: /var/lib/critical/main.db
    checkpoint-interval: 1m
    replica:
      type: s3
      bucket: critical-backups
      path: main
      region: us-east-1
      sync-interval: 10s

  # Directory of user databases
  - directory: /var/lib/users
    pattern: "user_*.db"
    recursive: false
    checkpoint-interval: 5m
    replica:
      type: s3
      bucket: user-backups
      path: users
      region: eu-west-1

# Global S3 settings (optional)
# These will be used as defaults for all S3 replicas unless overridden
access-key-id: ${AWS_ACCESS_KEY_ID}
secret-access-key: ${AWS_SECRET_ACCESS_KEY}

# Logging configuration
logging:
  level: info
  type: text
